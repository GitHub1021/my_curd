<#include "/WEB-INF/views/common/common.html"/>
<@layout>
<link rel="stylesheet" href="${ctx!}/res/css/magic-check.css">
<link rel="stylesheet" href="${ctx!}/res/layer/theme/default/layer.css">
<script>
    function newModel(){
        layerTools.layerIframe('新建','${ctx!}/sysOrg/newModel','600px','600px')
    }

    function editModel(){
        var node  = $("#tt").treegrid("getSelected");
        if(node!=null){
            layerTools.layerIframe('编辑','${ctx!}/sysOrg/newModel?id='+node.id,'600px','600px')
        }else{
            layerTools.layerMsg('请选择一行数据进行编辑');
        }
    }

    function deleteModel(){
        var node  = $("#tt").treegrid("getSelected");
        if(node!=null){
            layerTools.confirm(3,'删除', '您确定要删除选中的记录吗?',function(){
                $.post('${ctx}/sysOrg/deleteAction?id=' + node.id, function(data) {
                    layerTools.layerMsg(data,function(){
                        $('#tt').treegrid('reload');
                    });
                },"text");
            });
        }else{
            layerTools.layerMsg('请选择一行进行删除');
        }
    }

    function queryModel(){
        var queryParams = {
            search_LIKE_org_name : $("#orgName").textbox("getValue")
        };
        //alert(JSON.stringify(queryParams));
        $('#tt').treegrid('load', queryParams) ;
    }
</script>
</head>
<body>

<div id="nestLayout" class="easyui-layout" fit="true"  >
    <div data-options="region:'east' "
         split="true" border="false" collapsed="false"
         style="width: 500px;">
        <table id="dg" class="easyui-datagrid  " url="${ctx!}/sysOrg/queryUser"
               toolbar="#dgTB" rownumbers="true"   singleSelect="true"
               fit="true"
               fitColumns="true"
               pagination="true"
               pageSize="50"
               pageList="[50,100,150]"
               >
            <thead>
                <tr>
                    <th field="name" align="center" width="100">姓名</th>
                    <th field="username" align="center" width="100">登录名</th>
                    <th field="createTime" align="center" width="200">创建时间</th>
                    <th field="disabled" align="center" width="100" formatter="formatDisabled" >是否禁用</th>
                </tr>
            </thead>
        </table>
        <div id="dgTB" style="padding:10px;">
                <input id="cascadeSearch"  class="magic-checkbox"    type="checkbox" name="cascadeSearch" checked >
                <label for="cascadeSearch">级联查询</label>
        </div>
    </div>

    <div data-options="region:'center' "   split="true"  border="false" >
        <table id="tt"  border="false" ></table>
        <div id="tt-tb">
            <a onclick="newModel()"    class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" > 新增</a>
            <a onclick="editModel()"   class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" >编辑</a>
            <a onclick="deleteModel()"   class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" >删除</a>
            <span class="searchInputArea">
                <input id="orgName" prompt="机构名"  class="easyui-textbox" style="width:150px"  >
                <a onclick="queryModel()"  class="easyui-linkbutton" iconCls="icon-search"    >搜索</a>
            </span>
        </div>
    </div>

</div>

<script src="${ctx!}/res/js/easyui-tree-tools.js"></script>
<script src="${ctx!}/res/layer/layer.js"></script>
<script src="${ctx!}/res/js/layer-tools.js"></script>
<script type="text/javascript" charset="utf-8">

    function formatDisabled(val,row){
        if(val==0){
            val = '正常';
        }else{
            val = '<span style="color:red">'+无效+'</span>';
        }
        return val;
    };


    ;(function(){
        var easyTree = new  EasyTree();
        $("#tt").treegrid({
            url:'${ctx!}/sysOrg/query',
            method:'POST',
            idField:'id',
            treeField:'orgName',
            pagination:true,
            pageSize:50,
            pageList: [50,100],
            fit:true,
            rownumbers: true,
            toolbar: '#tt-tb',
            loadFilter:function(data){
                var rows = data.rows;
                rows  = easyTree.treeDataBuild(rows,'id','pid','orgName,orgAddress,orgRemark,sort');
                data.rows = rows;
                // console.log(JSON.stringify(data));
                return data;
            },
            columns:[[
                {field:'orgName',title:'机构名',width:300 },
                {field:'orgAddress',title:'机构地址',width:200 },
                {field:'orgRemark',title:'机构备注',width:200 },
                {field:'sort',title:'排序',width:80 }
            ]],
            onSelect:function(row){
                //alert(row.id);
                var queryParams={};
                if($('#cascadeSearch').prop('checked')){
                    queryParams.orgId = row.id;
                }else{
                    queryParams.search_EQ_org_id = row.id;
                }
                $('#dg').datagrid('load', queryParams) ;
            }
        });
    })();
</script>
</@layout>
